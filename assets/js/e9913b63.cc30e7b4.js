"use strict";(self.webpackChunkcreate_project_docs=self.webpackChunkcreate_project_docs||[]).push([[457],{28453:(e,r,n)=>{n.d(r,{R:()=>t,x:()=>c});var i=n(96540);const s={},d=i.createContext(s);function t(e){const r=i.useContext(d);return i.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function c(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),i.createElement(d.Provider,{value:r},e.children)}},60488:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"internal-contracts/prisma","title":"Prisma Client","description":"Singleton PrismaClient using the native PrismaPg adapter. Shared across all server-side code. Requires DATABASE_URL to be set before first import.","source":"@site/docs/internal-contracts/prisma.md","sourceDirName":"internal-contracts","slug":"/internal-contracts/prisma","permalink":"/project-code-battlegrounds-1-5/docs/internal-contracts/prisma","draft":false,"unlisted":false,"editUrl":"https://github.com/Capstone-Projects-2026-spring/project-code-battlegrounds-1-5/edit/main/documentation/docs/internal-contracts/prisma.md","tags":[],"version":"current","lastUpdatedBy":"samirbuch","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"Prisma Client"},"sidebar":"docsSidebar","previous":{"title":"Authentication Module","permalink":"/project-code-battlegrounds-1-5/docs/internal-contracts/auth"},"next":{"title":"Middleware","permalink":"/project-code-battlegrounds-1-5/docs/internal-contracts/proxy"}}');var s=n(74848),d=n(28453);const t={sidebar_position:3,title:"Prisma Client"},c="Prisma Client \u2014 src/lib/prisma.ts",l={},o=[{value:"Fields",id:"fields",level:2},{value:"Models",id:"models",level:2},{value:"Preconditions",id:"preconditions",level:2},{value:"Error handling",id:"error-handling",level:2},{value:"Example",id:"example",level:2}];function a(e){const r={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.header,{children:(0,s.jsxs)(r.h1,{id:"prisma-client--srclibprismats",children:["Prisma Client \u2014 ",(0,s.jsx)(r.code,{children:"src/lib/prisma.ts"})]})}),"\n",(0,s.jsxs)(r.p,{children:["Singleton ",(0,s.jsx)(r.code,{children:"PrismaClient"})," using the native ",(0,s.jsx)(r.code,{children:"PrismaPg"})," adapter. Shared across all server-side code. Requires ",(0,s.jsx)(r.code,{children:"DATABASE_URL"})," to be set before first import."]}),"\n",(0,s.jsx)(r.h2,{id:"fields",children:"Fields"}),"\n",(0,s.jsxs)(r.table,{children:[(0,s.jsx)(r.thead,{children:(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.th,{children:"Name"}),(0,s.jsx)(r.th,{children:"Type"}),(0,s.jsx)(r.th,{children:"Visibility"}),(0,s.jsx)(r.th,{children:"Description"})]})}),(0,s.jsxs)(r.tbody,{children:[(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"adapter"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"PrismaPg"})}),(0,s.jsx)(r.td,{children:"private"}),(0,s.jsxs)(r.td,{children:["PostgreSQL adapter constructed from ",(0,s.jsx)(r.code,{children:"DATABASE_URL"}),"."]})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"prisma"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"PrismaClient"})}),(0,s.jsx)(r.td,{children:"public"}),(0,s.jsx)(r.td,{children:"ORM client. Import this everywhere you need database access."})]})]})]}),"\n",(0,s.jsx)(r.h2,{id:"models",children:"Models"}),"\n",(0,s.jsxs)(r.table,{children:[(0,s.jsx)(r.thead,{children:(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.th,{children:"Model"}),(0,s.jsx)(r.th,{children:"Table"}),(0,s.jsx)(r.th,{children:"PK type"}),(0,s.jsx)(r.th,{children:"Notes"})]})}),(0,s.jsxs)(r.tbody,{children:[(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"User"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"user"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"String"})}),(0,s.jsxs)(r.td,{children:[(0,s.jsx)(r.code,{children:"email"})," is unique. Cascade-deletes ",(0,s.jsx)(r.code,{children:"Session"})," and ",(0,s.jsx)(r.code,{children:"Account"}),"."]})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"Session"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"session"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"String"})}),(0,s.jsxs)(r.td,{children:[(0,s.jsx)(r.code,{children:"token"})," is unique. Expires at ",(0,s.jsx)(r.code,{children:"expiresAt"}),"."]})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"Account"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"account"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"String"})}),(0,s.jsxs)(r.td,{children:["OAuth or credential record. FK to ",(0,s.jsx)(r.code,{children:"User"}),"."]})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"Verification"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"verification"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"String"})}),(0,s.jsx)(r.td,{children:"Short-lived token for email verification."})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"InfraTestKv"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"infra_test_kv"})}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"BigInt"})}),(0,s.jsx)(r.td,{children:"Infra connectivity test only. Do not use in application logic."})]})]})]}),"\n",(0,s.jsx)(r.h2,{id:"preconditions",children:"Preconditions"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"process.env.DATABASE_URL"})," must be a valid PostgreSQL connection string."]}),"\n",(0,s.jsxs)(r.li,{children:["All calls must be ",(0,s.jsx)(r.code,{children:"await"}),"ed."]}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"error-handling",children:"Error handling"}),"\n",(0,s.jsxs)(r.table,{children:[(0,s.jsx)(r.thead,{children:(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.th,{children:"Error"}),(0,s.jsx)(r.th,{children:"When"}),(0,s.jsx)(r.th,{children:"Recommended response"})]})}),(0,s.jsxs)(r.tbody,{children:[(0,s.jsxs)(r.tr,{children:[(0,s.jsxs)(r.td,{children:[(0,s.jsx)(r.code,{children:"PrismaClientKnownRequestError"})," P2002"]}),(0,s.jsx)(r.td,{children:"Unique constraint violated (e.g., duplicate email)."}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"409 Conflict"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsxs)(r.td,{children:[(0,s.jsx)(r.code,{children:"PrismaClientKnownRequestError"})," P2025"]}),(0,s.jsx)(r.td,{children:"Record not found on update/delete."}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"404 Not Found"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"PrismaClientInitializationError"})}),(0,s.jsxs)(r.td,{children:["DB unreachable or ",(0,s.jsx)(r.code,{children:"DATABASE_URL"})," missing."]}),(0,s.jsxs)(r.td,{children:["Log + ",(0,s.jsx)(r.code,{children:"500 Internal Server Error"})]})]})]})]}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.code,{children:"upsert"}),", ",(0,s.jsx)(r.code,{children:"create"}),", and ",(0,s.jsx)(r.code,{children:"update"})," are ",(0,s.jsx)(r.strong,{children:"not"})," idempotent by default. Callers that need idempotency must catch ",(0,s.jsx)(r.code,{children:"P2002"})," and handle it."]}),"\n",(0,s.jsx)(r.h2,{id:"example",children:"Example"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:'import { prisma } from "@/lib/prisma";\n\nconst user = await prisma.user.findUnique({\n  where: { email: "alice@example.com" },\n});\n\nawait prisma.infraTestKv.upsert({\n  where: { id: BigInt(1) },\n  update: { val: "updated" },\n  create: { id: BigInt(1), val: "created" },\n});\n'})})]})}function h(e={}){const{wrapper:r}={...(0,d.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}}}]);
"use strict";(self.webpackChunkcreate_project_docs=self.webpackChunkcreate_project_docs||[]).push([[5319],{28453:(e,s,n)=>{n.d(s,{R:()=>d,x:()=>l});var i=n(96540);const r={},t=i.createContext(r);function d(e){const s=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),i.createElement(t.Provider,{value:s},e.children)}},73292:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>l,default:()=>a,frontMatter:()=>d,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"internal-contracts/auth","title":"Authentication Module","description":"auth \u2014 src/lib/auth.ts","source":"@site/docs/internal-contracts/auth.md","sourceDirName":"internal-contracts","slug":"/internal-contracts/auth","permalink":"/project-code-battlegrounds-1-5/docs/internal-contracts/auth","draft":false,"unlisted":false,"editUrl":"https://github.com/Capstone-Projects-2026-spring/project-code-battlegrounds-1-5/edit/main/documentation/docs/internal-contracts/auth.md","tags":[],"version":"current","lastUpdatedBy":"samirbuch","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"Authentication Module"},"sidebar":"docsSidebar","previous":{"title":"Overview","permalink":"/project-code-battlegrounds-1-5/docs/internal-contracts/overview"},"next":{"title":"Prisma Client","permalink":"/project-code-battlegrounds-1-5/docs/internal-contracts/prisma"}}');var r=n(74848),t=n(28453);const d={sidebar_position:2,title:"Authentication Module"},l="Authentication Module",c={},o=[{value:"<code>auth</code> \u2014 <code>src/lib/auth.ts</code>",id:"auth--srclibauthts",level:2},{value:"Fields",id:"fields",level:3},{value:"Methods",id:"methods",level:3},{value:"<code>auth.api.getSession(options): Promise&lt;Session | null&gt;</code>",id:"authapigetsessionoptions-promisesession--null",level:4},{value:"<code>auth.handler</code>",id:"authhandler",level:4},{value:"<code>authClient</code> \u2014 <code>src/lib/auth-client.ts</code>",id:"authclient--srclibauth-clientts",level:2},{value:"Fields",id:"fields-1",level:3},{value:"Methods",id:"methods-1",level:3},{value:"<code>authClient.signIn.email(credentials, callbacks): Promise&lt;{ data: Session | null, error: AuthError | null }&gt;</code>",id:"authclientsigninemailcredentials-callbacks-promise-data-session--null-error-autherror--null-",level:4},{value:"<code>authClient.signUp.email(credentials, callbacks): Promise&lt;{ data: Session | null, error: AuthError | null }&gt;</code>",id:"authclientsignupemailcredentials-callbacks-promise-data-session--null-error-autherror--null-",level:4},{value:"<code>authClient.signOut(): Promise&lt;void&gt;</code>",id:"authclientsignout-promisevoid",level:4},{value:"<code>authClient.useSession(): { data: Session | null, isPending: boolean, error: Error | null, refetch: () =&gt; void }</code>",id:"authclientusesession--data-session--null-ispending-boolean-error-error--null-refetch---void-",level:4}];function h(e){const s={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"authentication-module",children:"Authentication Module"})}),"\n",(0,r.jsxs)(s.h2,{id:"auth--srclibauthts",children:[(0,r.jsx)(s.code,{children:"auth"})," \u2014 ",(0,r.jsx)(s.code,{children:"src/lib/auth.ts"})]}),"\n",(0,r.jsxs)(s.p,{children:["Server-side BetterAuth singleton. Configured with the Prisma/PostgreSQL adapter and email+password auth enabled. Using Google OAuth in the future. Requires ",(0,r.jsx)(s.code,{children:"DATABASE_URL"})," to be set before the module is imported."]}),"\n",(0,r.jsx)(s.h3,{id:"fields",children:"Fields"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Name"}),(0,r.jsx)(s.th,{children:"Type"}),(0,r.jsx)(s.th,{children:"Visibility"}),(0,r.jsx)(s.th,{children:"Description"})]})}),(0,r.jsx)(s.tbody,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"auth"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"BetterAuth"})}),(0,r.jsx)(s.td,{children:"public"}),(0,r.jsx)(s.td,{children:"Server-side auth instance. Used by API routes and middleware to validate sessions."})]})})]}),"\n",(0,r.jsx)(s.h3,{id:"methods",children:"Methods"}),"\n",(0,r.jsx)(s.h4,{id:"authapigetsessionoptions-promisesession--null",children:(0,r.jsx)(s.code,{children:"auth.api.getSession(options): Promise<Session | null>"})}),"\n",(0,r.jsxs)(s.p,{children:["Looks up the session from the request headers. Returns ",(0,r.jsx)(s.code,{children:"null"})," if no valid session cookie is present or the session is expired."]}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Parameter"}),(0,r.jsx)(s.th,{children:"Type"}),(0,r.jsx)(s.th,{children:"Description"})]})}),(0,r.jsx)(s.tbody,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"options.headers"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"Headers"})}),(0,r.jsx)(s.td,{children:"Request headers. Must contain the session cookie."})]})})]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Returns:"})," ",(0,r.jsx)(s.code,{children:"Session"})," (with ",(0,r.jsx)(s.code,{children:".user"})," and ",(0,r.jsx)(s.code,{children:".session"})," fields) or ",(0,r.jsx)(s.code,{children:"null"}),"."]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Preconditions:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"DATABASE_URL"})," must point to a reachable PostgreSQL instance."]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Throws:"})," Does not throw directly. If the database is unreachable, the underlying rejection propagates. Callers should wrap in ",(0,r.jsx)(s.code,{children:"try/catch"}),"."]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-typescript",children:'const session = await auth.api.getSession({\n  headers: await headers(),\n});\nif (!session) return NextResponse.redirect(new URL("/login", req.url));\n'})}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h4,{id:"authhandler",children:(0,r.jsx)(s.code,{children:"auth.handler"})}),"\n",(0,r.jsxs)(s.p,{children:["HTTP handler for all ",(0,r.jsx)(s.code,{children:"/api/auth/[...all]"})," routes (sign-in, sign-out, session refresh, etc.). Wrapped with ",(0,r.jsx)(s.code,{children:"toNodeHandler"})," for Next.js Pages Router compatibility."]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Preconditions:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["The API route must set ",(0,r.jsx)(s.code,{children:"export const config = { api: { bodyParser: false } }"}),". BetterAuth parses the body itself."]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Postconditions:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Sign-in: creates a ",(0,r.jsx)(s.code,{children:"Session"})," record in the database and sets a session cookie."]}),"\n",(0,r.jsxs)(s.li,{children:["Sign-out: deletes the ",(0,r.jsx)(s.code,{children:"Session"})," record and clears the cookie."]}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsxs)(s.h2,{id:"authclient--srclibauth-clientts",children:[(0,r.jsx)(s.code,{children:"authClient"})," \u2014 ",(0,r.jsx)(s.code,{children:"src/lib/auth-client.ts"})]}),"\n",(0,r.jsxs)(s.p,{children:["Browser-side BetterAuth client. Auth API base URL is read from ",(0,r.jsx)(s.code,{children:"BETTER_AUTH_URL"}),". All methods are non-throwing \u2014 errors come back through the return value or the ",(0,r.jsx)(s.code,{children:"onError"})," callback."]}),"\n",(0,r.jsx)(s.h3,{id:"fields-1",children:"Fields"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Name"}),(0,r.jsx)(s.th,{children:"Type"}),(0,r.jsx)(s.th,{children:"Visibility"}),(0,r.jsx)(s.th,{children:"Description"})]})}),(0,r.jsx)(s.tbody,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"authClient"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"AuthClient"})}),(0,r.jsx)(s.td,{children:"public"}),(0,r.jsx)(s.td,{children:"Client-side singleton. Use this in React components and pages."})]})})]}),"\n",(0,r.jsx)(s.h3,{id:"methods-1",children:"Methods"}),"\n",(0,r.jsx)(s.h4,{id:"authclientsigninemailcredentials-callbacks-promise-data-session--null-error-autherror--null-",children:(0,r.jsx)(s.code,{children:"authClient.signIn.email(credentials, callbacks): Promise<{ data: Session | null, error: AuthError | null }>"})}),"\n",(0,r.jsx)(s.p,{children:"Submits an email/password sign-in request."}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Parameter"}),(0,r.jsx)(s.th,{children:"Type"}),(0,r.jsx)(s.th,{children:"Description"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"credentials.email"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"string"})}),(0,r.jsx)(s.td,{children:"User's email."})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"credentials.password"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"string"})}),(0,r.jsx)(s.td,{children:"User's password."})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"credentials.callbackURL"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"string?"})}),(0,r.jsx)(s.td,{children:"Redirect target after sign-in."})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"callbacks.onRequest"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"(ctx) => void?"})}),(0,r.jsx)(s.td,{children:"Fired when the request is dispatched."})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"callbacks.onSuccess"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"(ctx) => void?"})}),(0,r.jsx)(s.td,{children:"Fired on successful sign-in."})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"callbacks.onError"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"(ctx) => void?"})}),(0,r.jsxs)(s.td,{children:["Fired on failure. ",(0,r.jsx)(s.code,{children:"ctx.error.message"})," has the reason."]})]})]})]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Preconditions:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"email"})," must be a valid email format."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"password"})," must be non-empty."]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Postconditions (success):"})," Session cookie is set in the browser. ",(0,r.jsx)(s.code,{children:"data"})," contains the session."]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Postconditions (failure):"})," ",(0,r.jsx)(s.code,{children:"error"})," is populated. No cookie is set."]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-typescript",children:'const { data, error } = await authClient.signIn.email(\n  { email: "user@example.com", password: "P@ssw0rd", callbackURL: "/dashboard" },\n  { onError: (ctx) => alert(ctx.error.message) },\n);\n'})}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h4,{id:"authclientsignupemailcredentials-callbacks-promise-data-session--null-error-autherror--null-",children:(0,r.jsx)(s.code,{children:"authClient.signUp.email(credentials, callbacks): Promise<{ data: Session | null, error: AuthError | null }>"})}),"\n",(0,r.jsx)(s.p,{children:"Registers a new account."}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Parameter"}),(0,r.jsx)(s.th,{children:"Type"}),(0,r.jsx)(s.th,{children:"Description"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"credentials.email"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"string"})}),(0,r.jsx)(s.td,{children:"Must be unique."})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"credentials.password"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"string"})}),(0,r.jsx)(s.td,{children:"Min 8 characters (enforced server-side)."})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"credentials.name"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"string"})}),(0,r.jsx)(s.td,{children:"Display name."})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"credentials.callbackURL"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"string?"})}),(0,r.jsx)(s.td,{children:"Post-verification redirect."})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"callbacks.onSuccess"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"(ctx) => void?"})}),(0,r.jsx)(s.td,{children:"Fired on successful registration."})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"callbacks.onError"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"(ctx) => void?"})}),(0,r.jsx)(s.td,{children:"Fired on failure (duplicate email, weak password, etc.)."})]})]})]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Preconditions:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"email"})," is not already registered."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"password"})," is at least 8 characters."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"name"})," is non-empty."]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Postconditions (success):"})," ",(0,r.jsx)(s.code,{children:"User"})," record created in DB. Session cookie set."]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Postconditions (failure):"})," No ",(0,r.jsx)(s.code,{children:"User"})," record created. ",(0,r.jsx)(s.code,{children:"error"})," is populated."]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-typescript",children:'await authClient.signUp.email(\n  { email: "new@example.com", password: "SecurePass1", name: "Alice" },\n  { onError: (ctx) => alert(ctx.error.message) },\n);\n'})}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h4,{id:"authclientsignout-promisevoid",children:(0,r.jsx)(s.code,{children:"authClient.signOut(): Promise<void>"})}),"\n",(0,r.jsx)(s.p,{children:"Deletes the current session from the database and clears the session cookie. No-op if the user is not signed in."}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h4,{id:"authclientusesession--data-session--null-ispending-boolean-error-error--null-refetch---void-",children:(0,r.jsx)(s.code,{children:"authClient.useSession(): { data: Session | null, isPending: boolean, error: Error | null, refetch: () => void }"})}),"\n",(0,r.jsx)(s.p,{children:"React hook. Fetches the current session on mount and re-renders the component when session state changes."}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"isPending"})," \u2014 ",(0,r.jsx)(s.code,{children:"true"})," during the initial fetch."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"data"})," \u2014 session object, or ",(0,r.jsx)(s.code,{children:"null"})," if unauthenticated."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"error"})," \u2014 non-null only if the fetch itself failed (network error, etc.)."]}),"\n"]})]})}function a(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}}}]);